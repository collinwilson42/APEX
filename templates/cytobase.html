<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CYTOBASE</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        /* ================================================================
           CYTOBASE — Neomorphic Radial Timepiece
           Seed 15BE — Mint Green + Teal Blue Only
           ================================================================ */

        :root {
            /* Backgrounds */
            --cyto-bg-deep:     #0a0b0d;
            --cyto-bg-core:     #12141a;
            --cyto-bg-surface:  #1a1d24;
            --cyto-bg-elevated: #22262f;

            /* Accent Colors — ONLY THESE TWO */
            --cyto-mint:        #ADEBB3;
            --cyto-mint-bright: #00ff9d;
            --cyto-teal:        #20B2AA;
            --cyto-teal-bright: #00f2ea;

            /* Text */
            --cyto-text-primary:   #F2F4F7;
            --cyto-text-secondary: #A4A9B3;
            --cyto-text-dim:       #6B7280;

            /* Neomorphic Shadows */
            --cyto-shadow-dark:  rgba(0, 0, 0, 0.7);
            --cyto-shadow-light: rgba(40, 44, 52, 0.2);

            /* Typography */
            --font-sans: 'Inter', -apple-system, sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-sans);
            background: var(--cyto-bg-deep);
            color: var(--cyto-text-primary);
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        /* ================================================================
           LAYER 1: RADIAL TIMEPIECE (Full-screen background, never moves)
           ================================================================ */

        #radial-canvas {
            position: fixed;
            inset: 0;
            z-index: 1;
            display: block;
        }

        /* ================================================================
           LAYER 2: HEADER BAR (Fixed top)
           ================================================================ */

        .cyto-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 50;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            background: linear-gradient(180deg, rgba(18, 20, 26, 0.95) 0%, rgba(10, 11, 13, 0.8) 100%);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        .cyto-header__left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .cyto-header__epoch {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            color: var(--cyto-text-dim);
        }

        .cyto-header__epoch-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--cyto-teal);
            box-shadow: 0 0 6px var(--cyto-teal);
            animation: pulse-dot 2s ease-in-out infinite;
        }

        @keyframes pulse-dot {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .cyto-header__epoch-text {
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--cyto-text-secondary);
        }

        .cyto-header__center {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .cyto-header__clock {
            font-family: var(--font-mono);
            font-size: 20px;
            font-weight: 500;
            color: var(--cyto-teal-bright);
            letter-spacing: 2px;
        }

        .cyto-header__date {
            font-size: 10px;
            color: var(--cyto-text-dim);
            letter-spacing: 0.5px;
        }

        .cyto-header__right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .cyto-header__class-badge {
            font-size: 11px;
            font-weight: 600;
            color: var(--cyto-teal);
            background: rgba(32, 178, 170, 0.1);
            padding: 4px 10px;
            border-radius: 6px;
            letter-spacing: 0.5px;
        }

        .cyto-header__window {
            font-family: var(--font-mono);
            font-size: 10px;
            color: var(--cyto-text-dim);
        }

        /* ================================================================
           LAYER 3: CONTROL PANEL (Floating bottom, collapsible)
           ================================================================ */

        .cyto-control {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 100;
            transition: height 300ms cubic-bezier(0.4, 0, 0.2, 1);
            background: var(--cyto-bg-core);
            border-radius: 16px 16px 0 0;
            box-shadow:
                0 -8px 32px rgba(0, 0, 0, 0.6),
                0 -2px 8px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.04);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .cyto-control--expanded {
            height: 50vh;
        }

        .cyto-control--collapsed {
            height: 44px;
        }

        /* Drag Handle / Collapsed Bar */
        .cyto-control__bar {
            flex-shrink: 0;
            height: 44px;
            display: flex;
            align-items: center;
            padding: 0 16px;
            cursor: pointer;
            user-select: none;
            gap: 16px;
            background: linear-gradient(180deg, var(--cyto-bg-elevated) 0%, var(--cyto-bg-core) 100%);
            border-bottom: 1px solid rgba(255, 255, 255, 0.04);
        }

        .cyto-control__bar:hover {
            background: linear-gradient(180deg, rgba(38, 42, 52, 1) 0%, var(--cyto-bg-core) 100%);
        }

        .cyto-control__handle {
            width: 40px;
            height: 4px;
            border-radius: 2px;
            background: rgba(255, 255, 255, 0.12);
            position: absolute;
            left: 50%;
            top: 6px;
            transform: translateX(-50%);
        }

        .cyto-control__bar-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--cyto-teal);
            letter-spacing: 1.5px;
            text-transform: uppercase;
        }

        .cyto-control__bar-stats {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .cyto-control__bar-stat {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .cyto-control__bar-stat-label {
            font-size: 9px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--cyto-text-dim);
        }

        .cyto-control__bar-stat-value {
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--cyto-teal);
        }

        .cyto-control__bar-divider {
            width: 1px;
            height: 16px;
            background: rgba(255, 255, 255, 0.08);
        }

        .cyto-control__chevron {
            margin-left: auto;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--cyto-text-dim);
            transition: transform 300ms ease;
        }

        .cyto-control--collapsed .cyto-control__chevron {
            transform: rotate(180deg);
        }

        /* Quadrant Grid */
        .cyto-control__grid {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            padding: 8px;
            min-height: 0;
            overflow: hidden;
        }

        /* Individual Quadrant — matches Intelligence Database exactly */
        .cyto-quadrant {
            display: flex;
            flex-direction: column;
            background: rgba(22, 24, 28, 0.95);
            border-radius: 12px;
            overflow: hidden;
            min-width: 0;
            min-height: 0;
            box-shadow:
                0 4px 12px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.03);
        }

        /* Quadrant Header */
        .cyto-quadrant__header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: rgba(18, 20, 24, 0.6);
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
            flex-shrink: 0;
            gap: 8px;
        }

        .cyto-quadrant__title {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--cyto-text-secondary);
        }

        /* Tab Group */
        .cyto-tab-group {
            display: flex;
            gap: 2px;
            background: rgba(0, 0, 0, 0.3);
            padding: 3px;
            border-radius: 6px;
        }

        .cyto-tab {
            padding: 5px 10px;
            background: transparent;
            border: none;
            border-radius: 4px;
            color: var(--cyto-text-dim);
            font-family: var(--font-sans);
            font-size: 10px;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.15s ease;
            white-space: nowrap;
        }

        .cyto-tab:hover {
            color: var(--cyto-text-secondary);
            background: rgba(255, 255, 255, 0.05);
        }

        .cyto-tab--active {
            color: var(--cyto-mint);
            background: rgba(173, 235, 179, 0.1);
        }

        /* Quadrant Content */
        .cyto-quadrant__content {
            flex: 1;
            overflow: auto;
            padding: 10px 12px;
            min-height: 0;
        }

        .cyto-quadrant__content::-webkit-scrollbar {
            width: 5px;
        }
        .cyto-quadrant__content::-webkit-scrollbar-track {
            background: transparent;
        }
        .cyto-quadrant__content::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 3px;
        }

        /* ================================================================
           Q1: CLASS BROWSER — Asset class tabs + instance list
           ================================================================ */

        .cyto-classes {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-bottom: 12px;
        }

        .cyto-class-btn {
            padding: 4px 10px;
            background: rgba(255, 255, 255, 0.04);
            border: none;
            border-radius: 4px;
            color: var(--cyto-text-dim);
            font-family: var(--font-mono);
            font-size: 10px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .cyto-class-btn:hover {
            color: var(--cyto-text-secondary);
            background: rgba(255, 255, 255, 0.08);
        }

        .cyto-class-btn--active {
            color: var(--cyto-teal-bright);
            background: rgba(0, 242, 234, 0.12);
        }

        .cyto-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px 10px;
            text-align: center;
            gap: 6px;
        }

        .cyto-empty__icon {
            width: 28px;
            height: 28px;
            color: var(--cyto-text-dim);
            opacity: 0.4;
        }

        .cyto-empty__title {
            font-size: 12px;
            font-weight: 600;
            color: var(--cyto-text-dim);
        }

        .cyto-empty__sub {
            font-size: 10px;
            color: rgba(107, 114, 128, 0.7);
        }

        /* ================================================================
           Q2: CONFIG / INSPECTOR — Tabs + epoch/cycle info
           ================================================================ */

        .cyto-config-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.04);
        }

        .cyto-config-row:last-child {
            border-bottom: none;
        }

        .cyto-config-label {
            font-size: 10px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--cyto-text-dim);
        }

        .cyto-config-value {
            font-family: var(--font-mono);
            font-size: 12px;
            color: var(--cyto-teal);
        }

        .cyto-asset-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 4px;
        }

        .cyto-asset-tag {
            font-family: var(--font-mono);
            font-size: 9px;
            font-weight: 500;
            padding: 3px 8px;
            border-radius: 4px;
            background: rgba(32, 178, 170, 0.1);
            color: var(--cyto-teal);
            letter-spacing: 0.3px;
        }

        /* ================================================================
           Q3: INSTANCE MANAGER — Input + counters
           ================================================================ */

        .cyto-instance-input {
            display: flex;
            gap: 6px;
            margin-bottom: 12px;
        }

        .cyto-instance-input input {
            flex: 1;
            height: 32px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 6px;
            padding: 0 10px;
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--cyto-text-primary);
            outline: none;
            transition: border-color 0.2s ease;
        }

        .cyto-instance-input input::placeholder {
            color: var(--cyto-text-dim);
            opacity: 0.6;
        }

        .cyto-instance-input input:focus {
            border-color: rgba(32, 178, 170, 0.4);
        }

        .cyto-instance-input button {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(32, 178, 170, 0.15);
            border: none;
            border-radius: 6px;
            color: var(--cyto-teal);
            font-size: 16px;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .cyto-instance-input button:hover {
            background: rgba(32, 178, 170, 0.25);
        }

        .cyto-stats-row {
            display: flex;
            gap: 8px;
        }

        .cyto-stat-card {
            flex: 1;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.02);
        }

        .cyto-stat-card__label {
            font-size: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--cyto-text-dim);
            margin-bottom: 4px;
        }

        .cyto-stat-card__value {
            font-family: var(--font-mono);
            font-size: 18px;
            font-weight: 700;
            color: var(--cyto-teal);
        }

        /* ================================================================
           Q4: EPOCH NAVIGATOR — Time window + scrubber
           ================================================================ */

        .cyto-time-windows {
            display: flex;
            gap: 4px;
            margin-bottom: 12px;
        }

        .cyto-time-btn {
            flex: 1;
            padding: 6px;
            background: rgba(255, 255, 255, 0.04);
            border: none;
            border-radius: 4px;
            color: var(--cyto-text-dim);
            font-family: var(--font-mono);
            font-size: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s ease;
            text-align: center;
        }

        .cyto-time-btn:hover {
            color: var(--cyto-text-secondary);
            background: rgba(255, 255, 255, 0.08);
        }

        .cyto-time-btn--active {
            color: var(--cyto-mint);
            background: rgba(173, 235, 179, 0.12);
        }

        .cyto-epoch-nav {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            padding: 8px 0;
        }

        .cyto-epoch-nav button {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.04);
            border: none;
            border-radius: 6px;
            color: var(--cyto-text-dim);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .cyto-epoch-nav button:hover {
            background: rgba(255, 255, 255, 0.08);
            color: var(--cyto-text-secondary);
        }

        .cyto-epoch-label {
            font-family: var(--font-mono);
            font-size: 12px;
            font-weight: 500;
            color: var(--cyto-text-primary);
            letter-spacing: 0.5px;
        }

        .cyto-epoch-sublabel {
            text-align: center;
            font-size: 10px;
            color: var(--cyto-text-dim);
            margin-top: 4px;
        }

        /* ================================================================
           BOTTOM STATUS BAR
           ================================================================ */

        .cyto-status {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 99;
            height: 24px;
            display: flex;
            align-items: center;
            padding: 0 12px;
            gap: 12px;
            background: rgba(10, 11, 13, 0.9);
            font-family: var(--font-mono);
            font-size: 10px;
            color: var(--cyto-text-dim);
        }

        .cyto-status__item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .cyto-status__label {
            color: var(--cyto-text-dim);
            opacity: 0.6;
        }

        .cyto-status__value {
            color: var(--cyto-text-dim);
        }

        .cyto-status__sep {
            color: rgba(255, 255, 255, 0.1);
        }

    </style>
</head>
<body>

    <!-- LAYER 1: Radial Timepiece Canvas -->
    <canvas id="radial-canvas"></canvas>

    <!-- LAYER 2: Header Bar -->
    <div class="cyto-header">
        <div class="cyto-header__left">
            <div class="cyto-header__epoch">
                <div class="cyto-header__epoch-dot"></div>
                <span class="cyto-header__epoch-text" id="header-epoch">Epoch: waiting for data</span>
            </div>
        </div>
        <div class="cyto-header__center">
            <div class="cyto-header__clock" id="header-clock">00:00:00 PM</div>
            <div class="cyto-header__date" id="header-date">February 11, 2026</div>
        </div>
        <div class="cyto-header__right">
            <span class="cyto-header__class-badge" id="header-class">All Classes</span>
            <span class="cyto-header__window">72h window</span>
        </div>
    </div>

    <!-- LAYER 3: Control Panel -->
    <div class="cyto-control cyto-control--expanded" id="control-panel">

        <!-- Collapse Bar -->
        <div class="cyto-control__bar" id="control-bar">
            <div class="cyto-control__handle"></div>
            <span class="cyto-control__bar-title">CYTOBASE</span>
            <div class="cyto-control__bar-stats">
                <div class="cyto-control__bar-stat">
                    <span class="cyto-control__bar-stat-label">Layer</span>
                    <span class="cyto-control__bar-stat-value" id="bar-layer">0</span>
                </div>
                <div class="cyto-control__bar-divider"></div>
                <div class="cyto-control__bar-stat">
                    <span class="cyto-control__bar-stat-label">Progress</span>
                    <span class="cyto-control__bar-stat-value" id="bar-progress">—</span>
                </div>
                <div class="cyto-control__bar-divider"></div>
                <div class="cyto-control__bar-stat">
                    <span class="cyto-control__bar-stat-label">Nodes</span>
                    <span class="cyto-control__bar-stat-value" id="bar-nodes">0</span>
                </div>
            </div>
            <div class="cyto-control__chevron" id="control-chevron">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
            </div>
        </div>

        <!-- Quadrant Grid -->
        <div class="cyto-control__grid" id="control-grid">

            <!-- Q1: Class Browser -->
            <div class="cyto-quadrant">
                <div class="cyto-quadrant__header">
                    <span class="cyto-quadrant__title">Classes</span>
                </div>
                <div class="cyto-quadrant__content">
                    <div class="cyto-classes" id="q1-classes">
                        <button class="cyto-class-btn cyto-class-btn--active" data-class="ALL">ALL</button>
                        <button class="cyto-class-btn" data-class="BTC">BTC</button>
                        <button class="cyto-class-btn" data-class="OIL">OIL</button>
                        <button class="cyto-class-btn" data-class="GOLD">GOLD</button>
                        <button class="cyto-class-btn" data-class="US100">US100</button>
                        <button class="cyto-class-btn" data-class="US30">US30</button>
                        <button class="cyto-class-btn" data-class="US500">US500</button>
                    </div>
                    <div class="cyto-empty" id="q1-empty">
                        <svg class="cyto-empty__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                            <path d="M2 17l10 5 10-5"/>
                            <path d="M2 12l10 5 10-5"/>
                        </svg>
                        <div class="cyto-empty__title">No instances</div>
                        <div class="cyto-empty__sub">Add one below</div>
                    </div>
                </div>
            </div>

            <!-- Q2: Config / Inspector -->
            <div class="cyto-quadrant">
                <div class="cyto-quadrant__header">
                    <span class="cyto-quadrant__title">Inspector</span>
                    <div class="cyto-tab-group">
                        <button class="cyto-tab cyto-tab--active" data-tab="nodes">Nodes</button>
                        <button class="cyto-tab" data-tab="layers">Layers</button>
                        <button class="cyto-tab" data-tab="config">Config</button>
                    </div>
                </div>
                <div class="cyto-quadrant__content" id="q2-content">
                    <!-- Config tab content (default visible) -->
                    <div id="q2-config">
                        <div class="cyto-config-row">
                            <span class="cyto-config-label">Epoch</span>
                            <span class="cyto-config-value">Waiting for first data sample</span>
                        </div>
                        <div class="cyto-config-row">
                            <span class="cyto-config-label">Cycle Duration</span>
                            <span class="cyto-config-value">72h</span>
                        </div>
                        <div class="cyto-config-row">
                            <span class="cyto-config-label">Slot Resolution</span>
                            <span class="cyto-config-value">15m × 288 slots</span>
                        </div>
                        <div class="cyto-config-row">
                            <span class="cyto-config-label">Fibonacci Bands</span>
                            <span class="cyto-config-value">0.618 · 1.000 · 1.618</span>
                        </div>
                        <div style="margin-top: 8px;">
                            <span class="cyto-config-label">Asset Classes</span>
                            <div class="cyto-asset-tags" style="margin-top: 6px;">
                                <span class="cyto-asset-tag">BTCF26</span>
                                <span class="cyto-asset-tag">USOILH26</span>
                                <span class="cyto-asset-tag">XAUJ26</span>
                                <span class="cyto-asset-tag">US100H26</span>
                                <span class="cyto-asset-tag">US30H26</span>
                                <span class="cyto-asset-tag">US500H26</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Q3: Instance Manager (Seed 16 — Live Process Status) -->
            <div class="cyto-quadrant">
                <div class="cyto-quadrant__header">
                    <span class="cyto-quadrant__title">Instances</span>
                </div>
                <div class="cyto-quadrant__content">
                    <!-- Live instance status grid (populated by CytoBaseStatus.init()) -->
                    <div id="cyto-instance-status"></div>
                </div>
            </div>

            <!-- Q4: Epoch Navigator -->
            <div class="cyto-quadrant">
                <div class="cyto-quadrant__header">
                    <span class="cyto-quadrant__title">Navigator</span>
                </div>
                <div class="cyto-quadrant__content">
                    <div class="cyto-time-windows">
                        <button class="cyto-time-btn" data-window="24h">24H</button>
                        <button class="cyto-time-btn cyto-time-btn--active" data-window="72h">72H</button>
                        <button class="cyto-time-btn" data-window="1w">1W</button>
                        <button class="cyto-time-btn" data-window="all">ALL</button>
                    </div>
                    <div class="cyto-epoch-nav">
                        <button id="epoch-prev">◀</button>
                        <span class="cyto-epoch-label" id="epoch-label">LIVE</span>
                        <button id="epoch-next">▶</button>
                    </div>
                    <div class="cyto-epoch-sublabel" id="epoch-sub">Waiting for first data sample</div>
                </div>
            </div>

        </div>
    </div>

    <!-- Bottom Status Bar (behind control panel) -->
    <div class="cyto-status">
        <span class="cyto-status__item">
            <span class="cyto-status__label">CYTOBASE</span>
        </span>
        <span class="cyto-status__sep">▏</span>
        <span class="cyto-status__item">
            <span class="cyto-status__label">▏—</span>
            <span class="cyto-status__value">0</span>
            <span class="cyto-status__label">—</span>
        </span>
        <span class="cyto-status__sep">·</span>
        <span class="cyto-status__item">
            <span class="cyto-status__label">Nodes</span>
            <span class="cyto-status__value">0</span>
        </span>
    </div>

    <!-- ================================================================
         JAVASCRIPT — Canvas Radial + Panel Logic
         ================================================================ -->
    <script>
    (function() {
        'use strict';

        // ============================================================
        // CONSTANTS
        // ============================================================
        const SLOT_COUNT = 288;
        const MAJOR_DIVISIONS = 24;        // Every 15° = 3 hours
        const SLOTS_PER_DIVISION = 12;
        const CYCLE_HOURS = 72;

        // Fibonacci bands (normalized 0-1 for radius mapping)
        const BANDS = [
            { ratio: 0.618, label: '0.618' },
            { ratio: 1.000, label: '1.000' },
            { ratio: 1.618, label: '1.618' }
        ];

        // Colors
        const C = {
            bgDeep:      '#0a0b0d',
            bgCore:      '#12141a',
            bgSurface:   '#1a1d24',
            bgElevated:  '#22262f',
            mint:        '#ADEBB3',
            mintBright:  '#00ff9d',
            teal:        '#20B2AA',
            tealBright:  '#00f2ea',
            textPrimary: '#F2F4F7',
            textSec:     '#A4A9B3',
            textDim:     '#6B7280',
        };

        // ============================================================
        // CANVAS SETUP
        // ============================================================
        const canvas = document.getElementById('radial-canvas');
        const ctx = canvas.getContext('2d');
        let W, H, cx, cy, maxR;

        function resize() {
            const dpr = window.devicePixelRatio || 1;
            W = window.innerWidth;
            H = window.innerHeight;
            canvas.width = W * dpr;
            canvas.height = H * dpr;
            canvas.style.width = W + 'px';
            canvas.style.height = H + 'px';
            ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
            cx = W / 2;
            cy = H / 2;
            maxR = Math.min(W, H) * 0.42;
        }

        window.addEventListener('resize', () => { resize(); draw(); });
        resize();

        // ============================================================
        // NEOMORPHIC RADIAL DRAWING
        // ============================================================

        function drawNeomorphicRing(centerX, centerY, radius, thickness, depth) {
            // Outer shadow (raised edge)
            const outerGrad = ctx.createRadialGradient(
                centerX, centerY, radius - thickness,
                centerX, centerY, radius + thickness * 0.5
            );
            outerGrad.addColorStop(0, 'rgba(0, 0, 0, 0)');
            outerGrad.addColorStop(0.3, `rgba(0, 0, 0, ${0.15 * depth})`);
            outerGrad.addColorStop(0.6, `rgba(0, 0, 0, ${0.35 * depth})`);
            outerGrad.addColorStop(0.85, `rgba(0, 0, 0, ${0.15 * depth})`);
            outerGrad.addColorStop(1, 'rgba(0, 0, 0, 0)');
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius + thickness * 0.5, 0, Math.PI * 2);
            ctx.arc(centerX, centerY, radius - thickness, 0, Math.PI * 2, true);
            ctx.fillStyle = outerGrad;
            ctx.fill();

            // Top-left highlight (neomorphic light source)
            ctx.save();
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius + 1, 0, Math.PI * 2);
            ctx.arc(centerX, centerY, radius - 1, 0, Math.PI * 2, true);
            ctx.strokeStyle = `rgba(50, 56, 66, ${0.12 * depth})`;
            ctx.lineWidth = thickness * 0.3;
            ctx.stroke();
            ctx.restore();
        }

        function drawSunkenDisc(centerX, centerY, radius) {
            // Deepest inset — the center
            const grad = ctx.createRadialGradient(
                centerX - radius * 0.15, centerY - radius * 0.15, 0,
                centerX, centerY, radius
            );
            grad.addColorStop(0, '#0d0e11');
            grad.addColorStop(0.5, '#090a0c');
            grad.addColorStop(1, '#0a0b0e');
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
            ctx.fillStyle = grad;
            ctx.fill();

            // Inner shadow ring
            const innerShadow = ctx.createRadialGradient(
                centerX, centerY, radius * 0.85,
                centerX, centerY, radius * 1.05
            );
            innerShadow.addColorStop(0, 'rgba(0, 0, 0, 0)');
            innerShadow.addColorStop(0.5, 'rgba(0, 0, 0, 0.5)');
            innerShadow.addColorStop(1, 'rgba(0, 0, 0, 0)');
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius * 1.05, 0, Math.PI * 2);
            ctx.arc(centerX, centerY, radius * 0.85, 0, Math.PI * 2, true);
            ctx.fillStyle = innerShadow;
            ctx.fill();

            // Subtle teal accent ring on edge
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
            ctx.strokeStyle = 'rgba(32, 178, 170, 0.15)';
            ctx.lineWidth = 1;
            ctx.stroke();
        }

        function drawNeomorphicBand(centerX, centerY, innerR, outerR, depth) {
            // The valley between rings — dark inset shadow
            const bandGrad = ctx.createRadialGradient(
                centerX, centerY, innerR,
                centerX, centerY, outerR
            );

            // Light edge → dark center → light edge (trough shape)
            bandGrad.addColorStop(0, `rgba(26, 29, 36, ${0.3 * depth})`);
            bandGrad.addColorStop(0.15, `rgba(10, 11, 13, ${0.6 * depth})`);
            bandGrad.addColorStop(0.35, `rgba(6, 7, 9, ${0.85 * depth})`);
            bandGrad.addColorStop(0.5, `rgba(5, 6, 8, ${0.95 * depth})`);
            bandGrad.addColorStop(0.65, `rgba(6, 7, 9, ${0.85 * depth})`);
            bandGrad.addColorStop(0.85, `rgba(10, 11, 13, ${0.6 * depth})`);
            bandGrad.addColorStop(1, `rgba(26, 29, 36, ${0.3 * depth})`);

            ctx.beginPath();
            ctx.arc(centerX, centerY, outerR, 0, Math.PI * 2);
            ctx.arc(centerX, centerY, innerR, 0, Math.PI * 2, true);
            ctx.fillStyle = bandGrad;
            ctx.fill();
        }

        function drawAccentRing(centerX, centerY, radius, color, alpha, width) {
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
            ctx.strokeStyle = color.replace(')', `, ${alpha})`).replace('rgb', 'rgba');
            ctx.lineWidth = width;
            ctx.stroke();
        }

        function drawPerimeterMarkers(centerX, centerY, radius) {
            const now = new Date();
            const epochStart = new Date(now);
            epochStart.setHours(epochStart.getHours() - (epochStart.getHours() % 72), 0, 0, 0);

            // 288 minor tick marks
            for (let i = 0; i < SLOT_COUNT; i++) {
                const angle = (i / SLOT_COUNT) * Math.PI * 2 - Math.PI / 2;
                const isMajor = (i % SLOTS_PER_DIVISION === 0);
                const tickInner = isMajor ? radius - 10 : radius - 4;
                const tickOuter = radius;

                ctx.beginPath();
                ctx.moveTo(
                    centerX + Math.cos(angle) * tickInner,
                    centerY + Math.sin(angle) * tickInner
                );
                ctx.lineTo(
                    centerX + Math.cos(angle) * tickOuter,
                    centerY + Math.sin(angle) * tickOuter
                );
                ctx.strokeStyle = isMajor
                    ? 'rgba(173, 235, 179, 0.4)'
                    : 'rgba(173, 235, 179, 0.08)';
                ctx.lineWidth = isMajor ? 1.5 : 0.5;
                ctx.stroke();

                // Major division pin dots
                if (isMajor) {
                    const dotR = radius + 6;
                    ctx.beginPath();
                    ctx.arc(
                        centerX + Math.cos(angle) * dotR,
                        centerY + Math.sin(angle) * dotR,
                        2, 0, Math.PI * 2
                    );
                    ctx.fillStyle = 'rgba(173, 235, 179, 0.5)';
                    ctx.fill();
                }
            }

            // Timestamps at major divisions
            ctx.font = '500 9px "JetBrains Mono", monospace';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            for (let i = 0; i < MAJOR_DIVISIONS; i++) {
                const slotIndex = i * SLOTS_PER_DIVISION;
                const angle = (slotIndex / SLOT_COUNT) * Math.PI * 2 - Math.PI / 2;
                const textR = radius + 20;
                const tx = centerX + Math.cos(angle) * textR;
                const ty = centerY + Math.sin(angle) * textR;

                // Calculate time for this slot
                const slotTime = new Date(epochStart.getTime() + slotIndex * 15 * 60 * 1000);
                const hours = slotTime.getHours();
                const ampm = hours >= 12 ? 'PM' : 'AM';
                const h12 = hours % 12 || 12;
                const mins = String(slotTime.getMinutes()).padStart(2, '0');

                // Every 4th major = show date, others show time
                let label;
                if (i % 4 === 0) {
                    const months = ['JAN','FEB','MAR','APR','MAY','JUN','JUL','AUG','SEP','OCT','NOV','DEC'];
                    label = `${months[slotTime.getMonth()]} ${slotTime.getDate()}, ${slotTime.getFullYear()}`;
                } else {
                    label = `${String(h12).padStart(2, '0')}:${mins} ${ampm}`;
                }

                ctx.save();
                ctx.translate(tx, ty);
                // Rotate text to follow circle
                const textAngle = angle + Math.PI / 2;
                // Flip text on bottom half so it's readable
                if (angle > 0 && angle < Math.PI) {
                    ctx.rotate(textAngle + Math.PI);
                } else {
                    ctx.rotate(textAngle);
                }
                ctx.fillStyle = 'rgba(173, 235, 179, 0.35)';
                ctx.fillText(label, 0, 0);
                ctx.restore();
            }
        }

        function drawCenterContent(centerX, centerY, radius) {
            // LIVE label
            ctx.font = '600 14px "Inter", sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillStyle = 'rgba(32, 178, 170, 0.7)';
            ctx.fillText('LIVE', centerX, centerY - 6);

            // Epoch sublabel
            ctx.font = '400 9px "JetBrains Mono", monospace';
            ctx.fillStyle = 'rgba(107, 114, 128, 0.5)';
            ctx.fillText('Epoch 0', centerX, centerY + 10);
        }

        function drawSpokes(centerX, centerY, innerR, outerR) {
            // 24 subtle spoke lines from center outward
            for (let i = 0; i < MAJOR_DIVISIONS; i++) {
                const angle = (i / MAJOR_DIVISIONS) * Math.PI * 2 - Math.PI / 2;
                ctx.beginPath();
                ctx.moveTo(
                    centerX + Math.cos(angle) * innerR,
                    centerY + Math.sin(angle) * innerR
                );
                ctx.lineTo(
                    centerX + Math.cos(angle) * outerR,
                    centerY + Math.sin(angle) * outerR
                );
                ctx.strokeStyle = 'rgba(173, 235, 179, 0.04)';
                ctx.lineWidth = 0.5;
                ctx.stroke();
            }
        }

        // ============================================================
        // MAIN DRAW
        // ============================================================

        function draw() {
            ctx.clearRect(0, 0, W, H);

            // Background gradient (radial from center)
            const bgGrad = ctx.createRadialGradient(cx, cy, 0, cx, cy, maxR * 1.8);
            bgGrad.addColorStop(0, '#0e1014');
            bgGrad.addColorStop(0.5, '#0b0c0f');
            bgGrad.addColorStop(1, '#08090b');
            ctx.fillStyle = bgGrad;
            ctx.fillRect(0, 0, W, H);

            // Ring radii (mapping Fibonacci bands to visual space)
            const centerR = maxR * 0.22;
            const r618 = maxR * 0.38;
            const r1000 = maxR * 0.60;
            const r1618 = maxR * 0.82;
            const outerR = maxR * 0.92;

            // === LAYER 1: Outermost neomorphic band (beyond 1.618) ===
            drawNeomorphicBand(cx, cy, r1618 + 8, outerR, 0.6);
            drawNeomorphicRing(cx, cy, outerR, 12, 0.8);

            // === LAYER 2: 1.618 ring ===
            drawNeomorphicRing(cx, cy, r1618, 14, 1.0);

            // === LAYER 3: Valley between 1.618 and 1.000 ===
            drawNeomorphicBand(cx, cy, r1000 + 6, r1618 - 6, 0.9);

            // === LAYER 4: 1.000 median ring (accent glow) ===
            drawNeomorphicRing(cx, cy, r1000, 12, 0.9);
            // Teal accent on the median
            ctx.beginPath();
            ctx.arc(cx, cy, r1000, 0, Math.PI * 2);
            ctx.strokeStyle = 'rgba(32, 178, 170, 0.12)';
            ctx.lineWidth = 2;
            ctx.stroke();

            // === LAYER 5: Valley between 1.000 and 0.618 ===
            drawNeomorphicBand(cx, cy, r618 + 6, r1000 - 6, 1.0);

            // === LAYER 6: 0.618 ring ===
            drawNeomorphicRing(cx, cy, r618, 10, 0.85);

            // === LAYER 7: Valley between 0.618 and center ===
            drawNeomorphicBand(cx, cy, centerR + 4, r618 - 4, 1.1);

            // === LAYER 8: Center disc ===
            drawSunkenDisc(cx, cy, centerR);

            // === SPOKES (very subtle) ===
            drawSpokes(cx, cy, centerR + 8, outerR - 4);

            // === PERIMETER MARKERS ===
            drawPerimeterMarkers(cx, cy, outerR);

            // === CENTER CONTENT ===
            drawCenterContent(cx, cy, centerR);

            // === Outer accent border ===
            ctx.beginPath();
            ctx.arc(cx, cy, outerR + 3, 0, Math.PI * 2);
            ctx.strokeStyle = 'rgba(32, 178, 170, 0.08)';
            ctx.lineWidth = 1;
            ctx.stroke();

            // Fibonacci band labels (subtle)
            ctx.font = '400 8px "JetBrains Mono", monospace';
            ctx.textAlign = 'left';
            ctx.fillStyle = 'rgba(107, 114, 128, 0.25)';
            const labelAngle = -Math.PI / 2 + 0.05;
            ctx.fillText('0.618', cx + Math.cos(labelAngle) * (r618 + 12), cy + Math.sin(labelAngle) * (r618 + 12));
            ctx.fillText('1.000', cx + Math.cos(labelAngle) * (r1000 + 12), cy + Math.sin(labelAngle) * (r1000 + 12));
            ctx.fillText('1.618', cx + Math.cos(labelAngle) * (r1618 + 12), cy + Math.sin(labelAngle) * (r1618 + 12));
        }

        // ============================================================
        // NODE DATA & RENDERING ENGINE
        // ============================================================
        let cytoNodes = [];          // Current nodes from API
        let activeFilter = 'ALL';    // Class filter
        let simRunning = false;      // Simulator state
        let pollInterval = null;
        const CLASS_COLORS = {
            BTC:   { r: 247, g: 147, b: 26  },  // Bitcoin orange
            OIL:   { r: 120, g: 180, b: 60  },  // Crude green
            GOLD:  { r: 255, g: 215, b: 0   },  // Gold
            US100: { r: 0,   g: 242, b: 234 },  // Cyan (our accent)
            US30:  { r: 173, g: 235, b: 179 },  // Mint (our primary)
            US500: { r: 32,  g: 178, b: 170 },  // Teal
        };

        function radiusToPixel(radius) {
            // Map 0.618→1.618 to r618→r1618 pixel positions
            const r618px = maxR * 0.38;
            const r1618px = maxR * 0.82;
            const t = (radius - 0.618) / (1.618 - 0.618); // 0→1
            const clamped = Math.max(0, Math.min(1, t));
            return r618px + clamped * (r1618px - r618px);
        }

        function slotToAngle(slot) {
            // 288 slots → full circle, starting at 12 o'clock (-PI/2)
            return (slot / SLOT_COUNT) * Math.PI * 2 - Math.PI / 2;
        }

        function getClassFromInstanceId(instanceId) {
            // Instance IDs look like: "BTCF26_SIM_20260211_123456"
            if (instanceId.includes('BTC'))   return 'BTC';
            if (instanceId.includes('OIL'))   return 'OIL';
            if (instanceId.includes('XAU'))   return 'GOLD';
            if (instanceId.includes('US100')) return 'US100';
            if (instanceId.includes('US30'))  return 'US30';
            if (instanceId.includes('US500')) return 'US500';
            return 'UNKNOWN';
        }

        function drawNodes() {
            if (!cytoNodes.length) return;

            const filtered = activeFilter === 'ALL'
                ? cytoNodes
                : cytoNodes.filter(n => n._class === activeFilter);

            for (const node of filtered) {
                const angle = slotToAngle(node.theta_slot);
                const r = radiusToPixel(node.radius || 1.0);
                const x = cx + Math.cos(angle) * r;
                const y = cy + Math.sin(angle) * r;

                const cls = node._class || 'US100';
                const color = CLASS_COLORS[cls] || CLASS_COLORS.US100;
                const size = Math.max(2, Math.min(12, node.size || 6));
                const sat = node.saturation || 0.5;
                const alpha = 0.3 + sat * 0.7;

                // Outer glow
                ctx.beginPath();
                ctx.arc(x, y, size + 3, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(${color.r}, ${color.g}, ${color.b}, ${alpha * 0.15})`;
                ctx.fill();

                // Main dot
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                const grad = ctx.createRadialGradient(x - size * 0.3, y - size * 0.3, 0, x, y, size);
                grad.addColorStop(0, `rgba(${Math.min(255, color.r + 60)}, ${Math.min(255, color.g + 60)}, ${Math.min(255, color.b + 60)}, ${alpha})`);
                grad.addColorStop(1, `rgba(${color.r}, ${color.g}, ${color.b}, ${alpha * 0.7})`);
                ctx.fillStyle = grad;
                ctx.fill();

                // Trade marker — diamond outline for nodes with trades
                if (node.has_trade) {
                    const d = size + 5;
                    ctx.beginPath();
                    ctx.moveTo(x, y - d);
                    ctx.lineTo(x + d, y);
                    ctx.lineTo(x, y + d);
                    ctx.lineTo(x - d, y);
                    ctx.closePath();
                    const pnlColor = (node.pnl || 0) >= 0
                        ? `rgba(173, 235, 179, ${alpha})`   // mint for profit
                        : `rgba(255, 100, 100, ${alpha})`;  // red for loss
                    ctx.strokeStyle = pnlColor;
                    ctx.lineWidth = 1.5;
                    ctx.stroke();
                }
            }
        }

        function drawFrame() {
            draw();      // Base radial (rings, ticks, labels)
            drawNodes(); // Overlay data nodes
            requestAnimationFrame(drawFrame);
        }

        // Start animation loop
        requestAnimationFrame(drawFrame);

        // ============================================================
        // DATA POLLING
        // ============================================================
        async function fetchAllNodes() {
            try {
                // First get simulator status to find instance IDs
                const statusRes = await fetch('/api/cyto/sim/status');
                const status = await statusRes.json();

                simRunning = status.running;
                updateSimIndicator();

                if (!status.running && !status.instances) {
                    // Not running, try to get any existing instances
                    const instRes = await fetch('/api/cyto/instances');
                    const instData = await instRes.json();
                    if (!instData.success || !instData.instances.length) return;

                    // Fetch nodes for each instance
                    const allNodes = [];
                    for (const inst of instData.instances) {
                        const cls = getClassFromInstanceId(inst.instance_id);
                        const res = await fetch(`/api/cyto/instances/${inst.instance_id}/radial`);
                        const data = await res.json();
                        if (data.success && data.nodes) {
                            for (const n of data.nodes) {
                                n._class = cls;
                                n._instance = inst.instance_id;
                            }
                            allNodes.push(...data.nodes);
                        }
                    }
                    cytoNodes = allNodes;
                    updateStats();
                    return;
                }

                // Simulator is running — use instance IDs from status
                const instances = status.instances || {};
                const allNodes = [];
                let totalTrades = 0;

                for (const [cls, info] of Object.entries(instances)) {
                    const instanceId = info.instance_id;
                    if (!instanceId) continue;
                    try {
                        const res = await fetch(`/api/cyto/instances/${instanceId}/radial`);
                        const data = await res.json();
                        if (data.success && data.nodes) {
                            for (const n of data.nodes) {
                                n._class = cls;
                                n._instance = instanceId;
                            }
                            allNodes.push(...data.nodes);
                            totalTrades += (info.trades || 0);
                        }
                    } catch (e) {
                        console.warn(`[Cyto] Failed to fetch ${cls}:`, e);
                    }
                }

                cytoNodes = allNodes;
                updateStats();

                // Update header
                document.getElementById('header-epoch').textContent =
                    `Epoch: ${status.session_id || 'none'} | Bars: ${status.bars_generated || 0}`;

            } catch (e) {
                console.warn('[Cyto] Poll failed:', e);
            }
        }

        function updateStats() {
            const filtered = activeFilter === 'ALL'
                ? cytoNodes
                : cytoNodes.filter(n => n._class === activeFilter);

            document.getElementById('bar-nodes').textContent = filtered.length;

            const trades = filtered.filter(n => n.has_trade);
            document.getElementById('bar-layer').textContent =
                new Set(filtered.map(n => n._instance)).size;

            // Progress: how many of 288 slots are filled
            const uniqueSlots = new Set(filtered.map(n => n.theta_slot)).size;
            const pct = Math.round((uniqueSlots / SLOT_COUNT) * 100);
            document.getElementById('bar-progress').textContent = `${pct}%`;

            // Update Q3 stats
            const avgSent = filtered.length
                ? (filtered.reduce((s, n) => s + (n.weighted_final || 0), 0) / filtered.length)
                : 0;
            const totalPnl = trades.reduce((s, n) => s + (n.pnl || 0), 0);
            const wins = trades.filter(n => (n.pnl || 0) > 0).length;
            const winRate = trades.length ? ((wins / trades.length) * 100) : 0;

            // Update stat values if elements exist
            const sentEl = document.getElementById('stat-sentiment');
            const tradesEl = document.getElementById('stat-trades');
            const pnlEl = document.getElementById('stat-pnl');
            const wrEl = document.getElementById('stat-winrate');
            if (sentEl) sentEl.textContent = avgSent.toFixed(3);
            if (tradesEl) tradesEl.textContent = trades.length;
            if (pnlEl) {
                pnlEl.textContent = `${totalPnl.toFixed(0)}`;
                pnlEl.style.color = totalPnl >= 0 ? '#ADEBB3' : '#ff6464';
            }
            if (wrEl) wrEl.textContent = `${winRate.toFixed(0)}%`;
        }

        function updateSimIndicator() {
            const dot = document.querySelector('.cyto-header__epoch-dot');
            if (dot) {
                dot.style.background = simRunning ? '#ADEBB3' : '#4a4a4a';
                dot.style.boxShadow = simRunning ? '0 0 6px #ADEBB3' : 'none';
            }
        }

        // Start polling (every 10 seconds)
        fetchAllNodes();
        pollInterval = setInterval(fetchAllNodes, 10000);

        // ============================================================
        // HEADER CLOCK
        // ============================================================
        function updateClock() {
            const now = new Date();
            const h = now.getHours();
            const ampm = h >= 12 ? 'PM' : 'AM';
            const h12 = h % 12 || 12;
            const m = String(now.getMinutes()).padStart(2, '0');
            const s = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('header-clock').textContent = `${String(h12).padStart(2,'0')}:${m}:${s} ${ampm}`;

            const months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
            document.getElementById('header-date').textContent = `${months[now.getMonth()]} ${now.getDate()}, ${now.getFullYear()}`;
        }
        updateClock();
        setInterval(updateClock, 1000);

        // ============================================================
        // CONTROL PANEL TOGGLE
        // ============================================================
        const panel = document.getElementById('control-panel');
        const bar = document.getElementById('control-bar');
        let panelExpanded = true;

        bar.addEventListener('click', function() {
            panelExpanded = !panelExpanded;
            if (panelExpanded) {
                panel.classList.remove('cyto-control--collapsed');
                panel.classList.add('cyto-control--expanded');
            } else {
                panel.classList.remove('cyto-control--expanded');
                panel.classList.add('cyto-control--collapsed');
            }
        });

        // ============================================================
        // TAB INTERACTIONS (Q1 classes, Q2 tabs, Q4 time windows)
        // ============================================================

        // Q1: Class tabs — filter radial nodes by asset class
        document.getElementById('q1-classes').addEventListener('click', function(e) {
            const btn = e.target.closest('.cyto-class-btn');
            if (!btn) return;
            this.querySelectorAll('.cyto-class-btn').forEach(b => b.classList.remove('cyto-class-btn--active'));
            btn.classList.add('cyto-class-btn--active');
            activeFilter = btn.dataset.class;
            document.getElementById('header-class').textContent =
                btn.dataset.class === 'ALL' ? 'All Classes' : btn.dataset.class;
            updateStats(); // Refresh stats for filtered view
        });

        // Q2: Inspector tabs
        document.querySelector('.cyto-tab-group').addEventListener('click', function(e) {
            const tab = e.target.closest('.cyto-tab');
            if (!tab) return;
            this.querySelectorAll('.cyto-tab').forEach(t => t.classList.remove('cyto-tab--active'));
            tab.classList.add('cyto-tab--active');
        });

        // Q4: Time window buttons
        document.querySelector('.cyto-time-windows').addEventListener('click', function(e) {
            const btn = e.target.closest('.cyto-time-btn');
            if (!btn) return;
            this.querySelectorAll('.cyto-time-btn').forEach(b => b.classList.remove('cyto-time-btn--active'));
            btn.classList.add('cyto-time-btn--active');
            document.querySelector('.cyto-header__window').textContent = btn.textContent.toLowerCase() + ' window';
        });

        // ============================================================
        // SEED 16: Instance Status Panel (Q3)
        // ============================================================
        // Inline CytoBaseStatus — polls /api/instance/status and renders live cards

        const CytoBaseStatus = {
            _pollInterval: null,
            _container: null,
            _status: null,

            init(containerId = 'cyto-instance-status') {
                this._container = document.getElementById(containerId);
                if (!this._container) return;
                this.refresh();
                this._pollInterval = setInterval(() => this.refresh(), 3000);
                window.CytoBaseStatus = this;
            },

            async refresh() {
                try {
                    const res = await fetch('/api/instance/status');
                    this._status = await res.json();
                    this._render();
                } catch (e) { /* silent */ }
            },

            _render() {
                if (!this._container || !this._status) return;
                const instances = this._status.instances || {};
                const running = this._status.running_count || 0;
                const total = this._status.total_count || 6;

                const sorted = Object.entries(instances).sort((a, b) => {
                    if (a[1].state === 'running' && b[1].state !== 'running') return -1;
                    if (a[1].state !== 'running' && b[1].state === 'running') return 1;
                    return a[0].localeCompare(b[0]);
                });

                this._container.innerHTML = `
                    <div style="display:flex;justify-content:space-between;align-items:center;padding:6px 8px 4px;">
                        <span style="font-family:'Inter',sans-serif;font-weight:600;font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:rgba(255,255,255,0.4);">PROCESSES</span>
                        <span style="font-family:'JetBrains Mono',monospace;font-size:11px;">
                            <span style="color:#5EEAD4;">${running}</span>
                            <span style="color:rgba(255,255,255,0.2);margin:0 2px;">/</span>
                            <span style="color:rgba(255,255,255,0.35);">${total}</span>
                        </span>
                    </div>
                    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:5px;padding:0 6px 6px;">
                        ${sorted.map(([key, info]) => this._card(key, info)).join('')}
                    </div>
                `;
                this._container.querySelectorAll('.cyto-inst-card').forEach(card => {
                    card.addEventListener('click', () => this._toggle(card.dataset.symbol));
                });
            },

            _card(key, info) {
                const isRunning = info.state === 'running';
                const isCrashed = info.state === 'crashed';
                const dot = isRunning ? '●' : isCrashed ? '✗' : '○';
                const dotColor = isRunning ? '#5EEAD4' : isCrashed ? '#F87171' : 'rgba(255,255,255,0.2)';
                const nameColor = isRunning ? '#A7F3D0' : isCrashed ? '#FCA5A5' : 'rgba(255,255,255,0.4)';
                let sub = 'IDLE';
                if (isRunning && info.runtime_seconds > 0) {
                    const m = Math.floor(info.runtime_seconds / 60);
                    const h = Math.floor(m / 60);
                    sub = h > 0 ? `${h}h ${m%60}m` : m > 0 ? `${m}m` : `${Math.floor(info.runtime_seconds)}s`;
                    sub = `${info.mode} · ${sub}`;
                } else if (isCrashed) sub = 'CRASHED';

                const glow = isRunning ? '0 0 10px rgba(94,234,212,0.08)' : 'none';
                return `
                    <div class="cyto-inst-card" data-symbol="${key}" title="Click to ${isRunning?'stop':'start'} ${key}"
                         style="background:rgba(22,24,28,0.95);border-radius:10px;padding:8px 6px;cursor:pointer;
                                box-shadow:2px 2px 6px rgba(0,0,0,0.4),-1px -1px 4px rgba(255,255,255,0.02),${glow};
                                display:flex;flex-direction:column;align-items:center;gap:3px;min-height:52px;justify-content:center;
                                transition:all 0.15s ease;">
                        <span style="font-size:12px;color:${dotColor};${isRunning?'text-shadow:0 0 6px rgba(94,234,212,0.5);':''}">${dot}</span>
                        <span style="font-family:'Inter',sans-serif;font-weight:600;font-size:10px;letter-spacing:0.5px;color:${nameColor};">${key}</span>
                        <span style="font-family:'JetBrains Mono',monospace;font-size:8px;color:${isRunning?'rgba(94,234,212,0.5)':'rgba(255,255,255,0.25)'};">${sub}</span>
                    </div>
                `;
            },

            async _toggle(symbol) {
                try {
                    await fetch(`/api/instance/${symbol}/toggle`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ mode: 'SIM' })
                    });
                    setTimeout(() => this.refresh(), 500);
                } catch (e) { console.error('Toggle error:', e); }
            },

            destroy() {
                if (this._pollInterval) { clearInterval(this._pollInterval); this._pollInterval = null; }
            }
        };

        // Initialize the instance status panel
        CytoBaseStatus.init();

    })();
    </script>
</body>
</html>
